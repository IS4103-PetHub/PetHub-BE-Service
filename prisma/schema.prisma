generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Entities
model User {
  userId        Int           @id @default(autoincrement())
  email         String        @unique
  password      String
  accountType   AccountType
  accountStatus AccountStatus @default(ACTIVE)
  dateCreated   DateTime      @default(now())
  lastUpdated   DateTime?

  // Enforcement of email being associated only with one type of account
  // must be implemented in your application logic as Prisma does not
  // support multi-table unique constraints
  internalUser InternalUser?
  petOwner     PetOwner?
  petBusiness  PetBusiness?
}

model InternalUser {
  firstName String
  lastName  String
  adminRole AdminRole

  user   User @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId Int  @id @unique
}

model PetOwner {
  firstName     String
  lastName      String
  contactNumber String
  dateOfBirth   DateTime

  user   User @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId Int  @id @unique
}

model PetBusiness {
  companyName         String
  uen                 String
  businessType        BusinessType?
  businessDescription String?
  contactNumber       String
  websiteURL          String?
  serviceListings ServiceListing[]
  // logo                String // TODO: figure out best way to save logos

  user   User @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId Int  @id @unique
}

model ServiceListing {
  serviceListingId Int @id @default(autoincrement())
  title String
  description String
  basePrice Int @default(0)
  dateCreated DateTime @default(now())
  lastUpdated   DateTime?

  category Category
  
  // tags that a service listing has (implicit many-to-many relationship)
  tags Tag[] 
  petBusiness PetBusiness @relation(fields:[petBusinessId], references: [userId], onDelete: Cascade, onUpdate: Cascade)
  petBusinessId Int
}

// m-n relation type between Tag and ServiceListing: implicit
// https://www.prisma.io/docs/concepts/components/prisma-schema/relations/many-to-many-relations#implicit-many-to-many-relations
model Tag {
  tagId       Int      @id @default(autoincrement())
  name        String   @unique
  dateCreated DateTime @default(now())
  lastUpdated   DateTime?
  
  // service listings with this tag (implicit many-to-many relationship)
  serviceListings ServiceListing[]
}

// enums
enum AccountStatus {
  ACTIVE
  INACTIVE
}

enum AccountType {
  PET_OWNER
  PET_BUSINESS
  INTERNAL_USER
}

enum AdminRole {
  MANAGER
  ADMINISTRATOR
}

enum BusinessType {
  FNB
  SERVICE
  HEALTHCARE
}

enum Category {
  PET_GROOMING
  DINING
  VETERINARY
  PET_RETAIL
  PET_BOARDING
}
